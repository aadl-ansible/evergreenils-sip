---
- name: Check if evergreen autogen exists
  stat:
    path: /openils/bin/autogen.sh
  register: evergreen_autogen
- name: Fail out if Evergreen autogen doesn't exist
  fail:
    msg: "Evergreen doesn't seem to be installed. NCIP needs to be on an Evergreen app server."
  when: not evergreen_autogen.stat.exists

- name: Checkout current SIP code
  git:
      repo: "{{ sip_repo }}"
      dest: "{{ sip_checkout_location }}"
      version: "{{ sip_version }}"

- name: Create oils_sip.xml from template
  template:
    src: oils_sip.xml.j2
    dest: "{{ opensrf_install_prefix }}/conf/oils_sip.xml"
    owner: opensrf
    group: opensrf
    mode: u=rw,g=rw,o=r
